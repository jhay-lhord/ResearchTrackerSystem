{%extends 'index.html'%} {% load static%} {% block title%} Research Tracker |
All Research {% endblock %}

<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
  crossorigin="anonymous"
/>

{% block content %}
<div class="row">
 
  <!-- First box -->
  <div class="col-xl-3 col-md-6">
    <div class="card card-default py-4 shadow">
      <div class="d-flex p-5 justify-content-between">
        <div class="icon-md bg-secondary rounded-circle mr-3">
          <i class="mdi mdi-sync"></i>
        </div>
        <a class="text-gray-dark" href="{% url 'ongoing'%}">
        <div class="text-right">
          <span
            class="h2 d-block text-success"
            id="research_ongoing_count"
          >
            {{research_data_as_of_today.research_ongoing_count}}</span
          >
          <p class="">Ongoing</p>
        </div>
      </a>
      </div>
    </div>
  </div>

  <!-- Second box -->
  <div class="col-xl-3 col-md-6">
    <div class="card card-default py-4 shadow">
      <div class="d-flex p-5 justify-content-between">
        <div class="icon-md bg-success rounded-circle mr-3">
          <i class="mdi mdi-trophy"></i>
        </div>
        <a class="text-gray-dark" href="{% url 'conducted'%}">
          <div class="text-right">
            <span
              class="h2 d-block text-success"
              id="research_conducted_count"
            >
              {{research_data_as_of_today.research_conducted_count}}</span
            >
            <p class="">Conducted</p>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Third box -->
  <div class="col-xl-3 col-md-6">
    <div class="card card-default py-4 shadow">
      <div class="d-flex p-5 justify-content-between">
        <div class="icon-md bg-primary rounded-circle mr-3">
          <i class="mdi mdi-presentation"></i>
        </div>
        <a class="text-gray-dark" href="{% url 'presented'%}">
          <div class="text-right">
            <span
              class="h2 d-block text-success"
              id="research_presented_count"
            >
              {{research_data_as_of_today.research_presented_count}}</span
            >
            <p class="">Presented</p>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Fourth box -->
  <div class="col-xl-3 col-md-6">
    <div class="card card-default py-4 shadow">
      <div class="d-flex p-5 justify-content-between">
        <div class="icon-md bg-info rounded-circle mr-3">
          <i class="mdi mdi-earth"></i>
        </div>
        <a class="text-gray-dark" href="{% url 'published'%}">
          <div class="text-right">
            <span
              class="h2 d-block text-success"
              id="research_published_count"
            >
              {{research_data_as_of_today.research_published_count}}</span
            >
            <p class="">Published</p>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <div class="card card-default shadow">
      <div class="card-header align-items-center">
        <h2 class="fw-bold">All Research </h2>
        <button type="button" class="btn btn-success btn-pill" data-toggle="modal" data-target="#modal-add-research"> <span class="mdi mdi-plus "></span> Add Research
        </button>
        
      </div>
      <div class="card-body" id="card-body">

        <!-- get data from back end and render it into the table-->

      </div>
    </div>
  </div>
</div>

<!-- Add New Research Modal -->
<div class="modal fade" id="modal-add-research" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg modal-fullscreen-sm-down" role="document">
    <div class="modal-content modal-dialog-scrollable">
      <div class="modal-header px-6">
        <h4 class="modal-title" id="exampleModalCenterTitle">Add New Research</h4>
      </div>
      
        
        <div class="modal-body px-6">
          <form method="POST" enctype="multipart/form-data">

          <div class="row mb-2">
           
            {% csrf_token %}
            <div class="col-12">
              <label for="researchTitle" class="form-label fw-semibold"
                >Research Title</label
              >
              <!-- <input type="text" class="form-control" id="researchTitle" placeholder="Research Tracker System"> -->
              {{form.Research_Title}}
            </div>
            <div class="col-md-6">
              <label for="researchStatus" class="form-label fw-semibold"
                >College</label
              >
              {{form.College}}
            </div>
            <div class="col-md-6">
              <label for="current-year" class="form-label fw-semibold"
                >Year</label
              >
              <!-- <input id="current-year" type="text" class="form-control"> -->
              {{form.Year}}
            </div>
            <div class="col-md-6">
              <label for="dateEnded" class="form-label fw-semibold"
                >Date Started</label
              >
              {{form.Date_Started}}
            </div>
            <div class="col-md-6">
              <label for="dateStarted" class="form-label fw-semibold"
                >Date Ended</label
              >
              {{form.Date_Ended}}
            </div>
            <div class="col-12">
              <label for="research_status" class="form-label fw-semibold"
                >Status</label
              >
              {{form.Status}}
            </div>
            <div class="col-12 hide-field" id="dateOngoing">
              <label for="dateOngoing" class="form-label fw-semibold"
                >Date On-going</label
              >
              {{form.Date_Ongoing}}
            </div>
            <div class="col-12 hide-field" id="dateConducted">
              <label for="dateConducted" class="form-label fw-semibold"
                >Date Conducted</label
              >
              {{form.Date_Conducted}}
            </div>
            <div class="col-12 hide-field" id="datePresented">
              <label for="datePresented" class="form-label fw-semibold"
                >Date Presented</label
              >
              {{form.Date_Presented}}
            </div>
    
            <div class="col-md-2 hide-field" id="ispnNo">
              <label for="" class="form-label fw-semibold">ISPN No.</label>
              {{form.ispnNo}}
            </div>
    
            <div class="col-md-6 hide-field" id="publisherName">
              <label for="" class="form-label fw-semibold"
                >Publisher Name</label
              >
              {{form.Publisher_Name}}
            </div>
    
            <div class="col-md-4 hide-field" id="datePublished">
              <label for="datePublished" class="form-label fw-semibold"
                >Date Published</label
              >
              {{form.Date_Published}}
            </div>
    
            <div class="col-md-6 hide-field" id="journalType">
              <label for="" class="form-label fw-semibold"
                >Type of Journal</label
              >
              {{form.Journal_Type}}
            </div>
    
            <div class="col-md-6 hide-field" id="journalIndex">
              <label for="" class="form-label fw-semibold"
                >Journal Index</label
              >
              {{form.Journal_Index}}
            </div>
    
            <div class="col-12">
              <label for="author" class="form-label fw-semibold"
                >Author</label
              >
              {{form.Author}}
            </div>
            <div class="col-12">
              <label for="fileUpload" class="form-label fw-semibold"
                >Upload File</label
              >
              {{form.Document_File}}
            </div>

          </div>
          <div class="modal-footer px-4">
            <button type="button" class="btn btn-smoke btn-pill" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-success btn-pill">Save Research</button>
          </div>
          </form>
        </div>
        
    </div>
  </div>
</div>

<!-- deleting modal -->
<div
  class="modal fade"
  id="delete_modal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          <span class="mdi mdi-alert-circle text-danger"></span> Confirm
          Deletion
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">X</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="">Are you sure you want to delete this file?</p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-success btn-pill"
          data-dismiss="modal"
        >
          Cancel
        </button>
        <button
          type="button"
          id="confirmDelete"
          class="btn btn-danger btn-pill"
        >
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

<!--  Uploading File  -->
<div
  class="modal fade"
  id="upload_modal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          <span class="mdi mdi-upload text-success"></span> Upload File
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
      <form id="uploadForm" method="post" enctype="multipart/form-data">
        <div class="modal-body">
          {% csrf_token %}
          <input type="hidden" id="research-input" name="research_id" />
          <div class="mb-3">
            <label for="formFile" class="form-label"
              >Please select File to upload</label
            >
            <input
              class="form-control"
              type="file"
              id="formFile"
              name="Document_File"
              accept=".pdf, .docx"
            />
          </div>
          <p id="file-error" class="text-warning fs-7"></p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-danger btn-pill"
            data-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="submit"
            id="confirmDelete"
            class="btn btn-success btn-pill"
          >
            Upload
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script type="module">
  const all_research_data_json = JSON.parse(
    "{{all_research_data_json|escapejs}}"
  );
  console.log(all_research_data_json);
  console.log("hahahah");

  let tableData = "";
  const container = document.getElementById("recent-added");
  const card_body = document.getElementById("card-body");

  all_research_data_json.forEach((research) => {
    
    const isFileEmptyOrDeleted = !research.Document_File;
    const updateUrl = `${research.update_url}`;

    tableData += `
      <tr>
          <td scope="row" class="fs-7">${research.Research_ID}</td>
          <td class="fs-7">${research.Research_Title}</td>
          <td class="fs-7">${research.Author}</td>
          <td class="fs-7 ${research.Status}">${research.Status}</td>
          <td class="fs-7">${research.updated_at}</td>
          <td class="fs-7">
            <a href="${updateUrl}">
              <button type="button" class="btn btn-success btn-pill btn-sm">View</button>
            </a> 
          </td>
          <td>
            ${
              isFileEmptyOrDeleted
                ? `<a href="#" > 
                        <button data-research-id="${research.Research_ID}" data-toggle="modal" data-target="#upload_modal" type="button" class="btn btn-smoke btn-pill btn-sm" id="upload-btn">Upload</button>
                    </a>`
                : `<a href="#" class="delete-research-link">
                        <button data-research-id="${research.Research_ID}" data-toggle="modal" data-target="#delete_modal" type="button" class="btn btn-outline-danger btn-pill btn-sm delete-research-link">Delete</button>
                    </a>`
            }
          </td>
          
      </tr>
  `;
  });
  const table = `
      <table  id="researchTable"
          class="table table-hover table-product"
          style="width: 100%">
          <thead class="">
              <tr>
                  <th scope="col" class="fs-7">Research ID</th>
                  <th scope="col" class="fs-7">Research Title</th>
                  <th scope="col" class="fs-7">Author</th>
                  <th scope="col" class="fs-7">Status</th>
                  <th scope="col" class="fs-7">Date Updated</th>
                  <th scope="col" class="fs-7">Action</th>
                  <th scope="col" class="fs-7">File</th>
              </tr>
          </thead>
          <tbody>
              ${tableData}
          </tbody>
      </table>
      `;
      card_body.innerHTML = table;
  console.log(all_research_data_json.Author);
</script>

<script src="{% static 'js/show_hide_date.js'%}"></script>
<script src="{%static 'js/delete_file.js'%}" defer></script>
<script src="{%static 'js/upload_file.js'%}" defer></script>
<script src="{%static 'js/file_upload_validation.js'%}" defer></script>

{% endblock%} 